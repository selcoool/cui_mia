#include <Arduino.h>
#include <HardwareSerial.h>
#include "sbus.h"  // thÆ° viá»‡n SBUS tá»« lib/sbus

#define RX1_PIN 3  // GPIO16 nháº­n tÃ­n hiá»‡u SBUS


// ;   https://github.com/bolderflight/sbus.git
// Táº¡o cá»•ng UART1 cho SBUS
HardwareSerial SerialSBUS(1);

// Khá»Ÿi táº¡o SBUS reader
bfs::SbusRx sbus(&SerialSBUS, RX1_PIN, -1, true);  // RX, TX = -1 (khÃ´ng dÃ¹ng), inverted = true

void setup() {
  Serial.begin(115200);
  delay(1000);
  Serial.println("ðŸ”Œ ESP32 SBUS Receiver Started");

  // Báº¯t Ä‘áº§u UART1 vá»›i SBUS settings: 100000 baud, 8E2
  SerialSBUS.begin(100000, SERIAL_8E2, RX1_PIN, -1);

  // Báº¯t Ä‘áº§u nháº­n SBUS
  sbus.Begin();
}

void loop() {
  if (sbus.Read()) {
    const bfs::SbusData &data = sbus.data();

    // In 8 kÃªnh Ä‘áº§u
    for (int i = 0; i < 8; i++) {
      Serial.print("CH");
      Serial.print(i);
      Serial.print(": ");
      Serial.print(data.ch[i]);
      Serial.print("  ");
    }

    Serial.println();
    delay(10);
  }
}

